<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{{ service_name }} | User</title>
        <link href="{{url_for('static', filename='css/bootstrap.min.css')}}" rel="stylesheet">
        <link href="{{url_for('static', filename='css/shuggle.css')}}" rel="stylesheet">

        <script type="text/javascript" src="{{url_for('static', filename='js/jquery-3.7.1.min.js')}}"></script>

        <script>
            $(document).ready(function() {
                var next_url = "{{next_url}}";
                var login = "{{login}}";
                var url_from = "{{from_url}}";
                
                // ログインしてきたときは自動で飛ぶ
                if (login == "true") {
                    if (next_url != "") {
                        window.location.href = next_url;
                    }
                    else {
                        window.location.href = "/";
                    }                    
                    return;
                }
            });

            function stringToHTML(str) {
                var dom = document.createElement('div');
                dom.innerHTML = str;
                return dom;
            }

            function logoutClick() {
                // ログアウトする→logoutページで処理
                window.location.href = "/logout";
            }

            function visibleChangeName() {
                div_change_name = document.getElementById('div-change-name');
                if (div_change_name.style.visibility == 'visible') {
                    div_change_name.style.visibility = 'hidden';
                } else {
                    div_change_name.style.visibility = 'visible';
                    div_change_password.style.visibility = 'hidden';
                }
            }
            
            function visibleChangePassword() {
                div_change_password = document.getElementById('div-change-password');
                if (div_change_password.style.visibility == 'visible') {
                    div_change_password.style.visibility = 'hidden';
                } else {
                    div_change_password.style.visibility = 'visible';
                    div_change_name.style.visibility = 'hidden';
                }
            }
        </script>
    
    </head>
    <body>
        <div class="container col-11">
            <h1><a class="navbar-brand" href="/">IR <span style="color:#00a497">T</span>asks</a></h1>
        </div>

        <br>

        <div class="container col-11">
            <div class="row">
                <h2>ようこそ <span id="user-name">{{user_name}}</span>{{achievement}} さん</h2>
            </div>
            {% if message != "" %}
            <div class="row">
                {{message}}
            </div>
            {% endif %}

            <!-- ユーザ情報表示 -->
            <div class="row">
                <div class="container col-2">
                    <button class="w-100 p-2 btn btn-outline-light" style="pointer-events: none;">Email address</button>
                </div>
                <div class="container col-10 d-flex align-items-center" id="user-info-email">
                    {{email}}
                </div>
            </div>
            <br>
            <div class="row">
                <div class="container col-2">
                    <button class="w-100 p-2 btn btn-outline-light" style="pointer-events: none;">ユーザ名</button>
                </div>
                <div class="container col-10 d-flex align-items-center" id="user-info-name">
                    {{user_name}}
                </div>
            </div>
            <br>
            <br>
            
            
            <!-- Task一覧へのリンク -->
            <div class="row">
                <div class="container col-2">
                    <a href="/"><button id="btn-root" class="w-100 p-2 form-control-lg btn btn-outline-info">Task一覧へ</button></a>
                </div>
                <div class="container col-10">
                </div>
            </div>

            <br>

            <!-- ユーザ名変更 -->
            <div class="row">
                <div class="container col-2">
                    <button onclick="visibleChangeName()" id="btn-change-name" class="w-100 p-2 form-control-lg btn btn-outline-info">ユーザ名の変更</button>
                </div>
                <div class="container col-5">
                    <div id="div-change-name" style="visibility: hidden;">
                        <form method="POST">
                            <div class="input-group mb-3">
                                <input type="text" name="newName" maxlength="18" pattern="^[\-\._0-9A-Za-z]+$" class="form-control" placeholder="新しい表示ユーザ名" aria-describedby="button-addon2">
                                <input type="submit" name="buttonChangeName" value="変更" class="btn btn-outline-info" id="button-addon2">
                                <input type="hidden" name="userID" id="input-user-id" value="{{user_id}}">
                                <input type="hidden" name="userKey" id="input-user-key" value="{{user_key}}">
                            </div>
                        </form>
                        使える文字：半角英数、記号「_.-」
                    </div>
                </div>
                <div class="container col-5">
                </div>
            </div>

            <!-- パスワード変更 -->
            <div class="row">
                <div class="container col-2">
                    <button onclick="visibleChangePassword()" id="btn-change-password" class="w-100 p-2 form-control-lg btn btn-outline-info">パスワードの変更</button>
                </div>
                <div class="container col-5">
                    <div id="div-change-password" style="visibility: hidden;">
                        <form class="form-signin" method="POST">
                            <label for="inputPassword" class="sr-only">新しいPassword</label>
                            <input type="password" name="inputPassword" class="form-control" placeholder="Password" maxlength="18" pattern="^[\-\._0-9A-Za-z]+$" required>
                            <label for="inputPasswordVerify" class="sr-only">新しいPassword(もう一度)</label>
                            <input type="password" name="inputPasswordVerify" class="form-control" placeholder="Password" maxlength="18" pattern="^[\-\._0-9A-Za-z]+$" required>
                            使える文字：半角英数、記号「_.-」<br>
                            <input type="submit" name="buttonChangePassword" value="変更" class="btn btn-outline-info" type="button" style="margin-top:1rem;">
                            <input type="hidden" name="userID" id="input-pass-user-id" value="{{user_id}}">
                            <input type="hidden" name="userKey" id="input-pass-user-key" value="{{user_key}}">
                        </form>
                    </div>
                </div>
                <div class="container col-5">
                </div>
            </div>
            <div class="row">
                <div class="container col-10">
                </div>
                <div class="container col-2">
                    <button onclick="logoutClick()" id="btn-logout" class="w-100 p-2 form-control-lg btn btn-outline-secondary">ログアウト</button>
                </div>
            </div>
        </div>

        <br>

        <div class="container col-11">
            <h2>提出した<span style="color:#00a497">T</span>ask一覧</h2>
        </div>
        <div class="container col-11" id="task-table">
            {{my_task_table}}
        </div>

        <div class="container col-11">
            <h2>これまでの提出一覧</h2>
        </div>
        <div class="container col-11" id="submit-table">
            {{submit_table}}
        </div>

        <script type="text/javascript" src="{{url_for('static', filename='js/bootstrap.js')}}"></script>
    </body>
</html>
